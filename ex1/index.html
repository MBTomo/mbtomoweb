<!DOCTIPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>松橋駅前　公共交通案内</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
  <h2>次の5便スケジュール</h2>
  <table id="scheduleTable">
    <thead>
      <tr>
        <th>行先（trip_headsign）</th>
        <th>路線名（route_long_name）</th>
        <th>出発時刻（departure_time）</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function loadAndDisplayCSV() {
      // 1. CSVを取得してテキスト化
      const response = await fetch('timetable_mon.csv');
      const csvText = await response.text();
      
      // 2. 行ごとに分割してヘッダとデータに分ける
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      const rows = lines.slice(1).map(line => {
        const cells = line.split(',').map(c => c.trim());
        return headers.reduce((obj, key, i) => {
          obj[key] = cells[i];
          return obj;
        }, {});
      });

      // 3. 現在時刻以降のデータを抽出して先頭5件
      const now = new Date();
      const upcoming = [];
      for (const row of rows) {
        const [hh, mm, ss] = row.departure_time.split(':').map(Number);
        const dep = new Date(
          now.getFullYear(), now.getMonth(), now.getDate(), hh, mm, ss
        );
        if (dep > now) {
          upcoming.push(row);
          if (upcoming.length === 5) break;
        }
      }

      // 4. テーブルに描画
      const tbody = document.querySelector('#scheduleTable tbody');
      upcoming.forEach(row => {
        const tr = document.createElement('tr');
        ['trip_headsign', 'route_long_name', 'departure_time']
          .forEach(key => {
            const td = document.createElement('td');
            td.textContent = row[key];
            tr.appendChild(td);
          });
        tbody.appendChild(tr);
      });
    }

    loadAndDisplayCSV().catch(console.error);
  </script>
</html>